<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dispositivos</title>
</head>
<body>
    <h1>Dispositivos</h1>

    <div>
        <label for="potValue">Informacion del potenciometro:</label>
        <span id="potOutput"></span>
        <br>
        <label for="ledValue">Valor del led:</label>
        <p> 0 es apagado </p>
        <p> 1 es encendido </p>
        <input type="number" id="ledValue" min='0' max='1'/>
        <button onclick="actualizarDispo()">Actualizar</button>
    </div>

    <div id="output"></div>

    <script>
        document.body.onload = obtenerDispo();
    
        async function obtenerDispo() {

            const response_led = await fetch(`https://backendesp-c2ae18e5982d.herokuapp.com/dispositivos/1`);
            const response_pot = await fetch(`https://backendesp-c2ae18e5982d.herokuapp.com/dispositivos/2`);

            const device_led = await response_led.json();
            const device_pot = await response_pot.json();

            const potenciometro = document.getElementById('potOutput');

            potenciometro.innerHTML = `
            <p>Valor: ${device_pot.valor}</p>
            `;

            const led = document.getElementById('ledValue');

            led.value = device_led.valor;

            //console.log(device_led);
            //console.log(device_pot);
        }

        async function actualizarDispo() {

            const reponse_get = await fetch(`https://backendesp-c2ae18e5982d.herokuapp.com/dispositivos/1`);

            const device_led = await reponse_get.json();


            const ledValue = document.getElementById('ledValue').value;

            console.log(ledValue);

            var numero = parseInt(ledValue);

            if (numero > 1 || numero < 0){
                alert('Por favor, ingrese solo el numero 0 o 1');

            } else {
                const response = await fetch(`https://backendesp-c2ae18e5982d.herokuapp.com/dispositivos/${device_led.id}`, {
                    method: 'PUT',
                    headers: {
                        'accept': 'application/json',
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        id: `${device_led.id}`,
                        pot: device_led.dispositivo,
                        led: ledValue,
                    }),
                });

                const actualizadoDispo = await response.json();

                document.getElementById('output').innerHTML = JSON.stringify(actualizadoDispo);

                if (ledValue === '1'){

                    alert('Se encendio el led');

                } else {

                    alert('Se apago el led');
                }
            }
        }


    </script>
</body>
</html>
